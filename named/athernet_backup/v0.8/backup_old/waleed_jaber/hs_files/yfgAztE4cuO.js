if (self.CavalryLogger) { CavalryLogger.start_js(["nV6qp"]); }

__d("FacebarDataSource",["invariant","Arbiter","AsyncRequest","AsyncResponse","CSRFGuard","CurrentUser","FacebarFindPeopleAndPages","FacebarGlobalOptions","FacebarGSv2Echo","FacebarInviteCoworkers","FacebarJSConstants","FacebarKeywordSearchUtils","FacebarResultStore","FacebarResultStoreUtils","FacebarSimplifiedNoFlickerResults","FacebarStructuredText","FacebarTimerUtils","FacebarTokenizer","FacebarURI","ResultsBucketizer","ResultsBucketizerConfig","SearchDataSource","Vector","ViewportBounds","XHRRequest","emptyFunction","gkx","queryThenMutateDOM","throttle"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h,i=50,j={};c=babelHelpers.inherits(a,b("SearchDataSource"));h=c&&c.prototype;function a(a){__p&&__p();h.constructor.call(this,a),this.executeQuery=function(a,c,d){__p&&__p();this._curQueryId++;d!=null&&(d.queryId=this._curQueryId,d.startCacheQuery=b("FacebarTimerUtils").getTimestamp());var e=this.getMaxResults();this.setQueryData({qid:this._curQueryId,max_results:e});this.inform("beforeQuery",{value:a,queryId:this._curQueryId});this.value=a;e=this.buildUids(a,[]);d!=null&&(d.endCacheQuery=b("FacebarTimerUtils").getTimestamp());c&&e.length===0&&e.push(c);this.inform("query",{value:a,results:e,queryId:this._curQueryId});this.resultStore&&this.respond(a,e,!1,!1,d)}.bind(this),this.sendRemoteQuery=function(a,c,d,e,f,g){__p&&__p();var h=this.getQueryData(a.text_form),i=d!=null?d.queryId:0;if(g){var j=this.globallyCachedKeywordsTTL*60;j=new(b("XHRRequest"))(this.globalKeywordsEndpoint).setData({value:h.value,platform:"desktop",ttl:this.globallyCachedKeywordsTTL,global:this.globallyCachedKeywordsUseCDN,use_dt:this.globallyCachedKeywordsUseDT}).setMethod("GET").setRequestHeader("Cache-Control","max-age="+j).setResponseHandler(function(f,h){h=b("CSRFGuard").clean(h);h=JSON.parse(h);this.handleQueryResponse(new(b("AsyncResponse"))(null,h),f,a,c,d,e,g);this.activityEnd()}.bind(this,i)).setErrorHandler(function(a){return this.activityEnd()}.bind(this));this.inform("sending_global_request",j);this._maxRemoteQueryId=i;d!=null&&(d.waitingQueries=this._waitingQueries,d.inflightRequests=b("AsyncRequest").getInflightCount(),d.startRemoteQuery=b("FacebarTimerUtils").getTimestamp());j.send();this.activityStart()}else{h.gs_prefetch_mode=e;f&&(h.max_results=f);this.globallyCachedKeywordsUseCDN&&!this._single_state&&(h.log_global_hit=!0,h.log_global_ttl=this.globallyCachedKeywordsTTL,h.log_global_platform="desktop",h.log_dt=this.globallyCachedKeywordsUseDT);j=new(b("AsyncRequest"))().setURI(this.queryEndpoint).setData(h).setMethod("GET").setReadOnly(!0).setAllowCrossPageTransition(!0).setHandler(function(b,f){this.handleQueryResponse(f,b,a,c,d,e,g)}.bind(this,i)).setFinallyHandler(function(){this.activityEnd()}.bind(this));for(var f=this._headerflags,h=Array.isArray(f),k=0,f=h?f:f[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var l;if(h){if(k>=f.length)break;l=f[k++]}else{k=f.next();if(k.done)break;l=k.value}l=l;var m=l[0];l=l[1];j.setRequestHeader(m,l)}this.inform("sending_request",j);this._maxRemoteQueryId=i;d!=null&&(d.waitingQueries=this._waitingQueries,d.inflightRequests=b("AsyncRequest").getInflightCount(),d.startRemoteQuery=b("FacebarTimerUtils").getTimestamp());j.send();this.activityStart()}}.bind(this),this.renderResults=function(a,c,d,e,f,g){f!=null?j[String(a)]=f:f=j[String(a)],b("FacebarGSv2Echo").insertInto(a,c,!d,this._single_state,this._is_local,this._categoryName),a!=null&&b("FacebarGSv2Echo").normalizeValue(a).length>0&&this._single_state!==!0&&!b("FacebarGlobalOptions").hasKeywordOnlyTypeahead&&(!b("CurrentUser").isWorkUser()||!b("gkx")("678799"))&&b("FacebarSimplifiedNoFlickerResults").insertInto(c),!!a&&a instanceof b("FacebarStructuredText")&&!a.isEmptyOrWhitespace()&&!this._bypassBucketizer&&(c=this._bucketizeResults(a,c,f)),c.length=Math.min(c.length,this.getMaxResults()),this.injectExtraResults(a,c),e=d&&c.length===0,this.inform("respond",{value:a,results:c,isAsync:!!d,isEmptyResults:e})}.bind(this),this._fetched_null_state=null,this._initialQueryData=null,this._curQueryId=-1,this._maxRemoteQueryId=-1,this._single_state=!1,this._is_local=!1,this._categoryName=null,this._waitingQueries=0,this.mixGrammarAndEntity=a.mixGrammarAndEntity!==void 0?a.mixGrammarAndEntity:!0,this._isInjectedSuggestionFlow=!1,this.grammarVersion=a.grammarVersion||"",a.grammarOptions||(a.grammarOptions={}),this._headerflags=a.headerflags||new Map(),this.recordingRoute="banzai_vital",this._maxGrammarResults=a.grammarOptions.maxGrammarResults,this.nullStateEndpoint=a.nullStateEndpoint||"/ajax/browse/null_state.php",this.setNullStateData(a.nullStateData||{},!0),this._minQueryLength=a.minQueryLength||-1,this._performShortQuery=a.performShortQuery||!1,this._fixProcessLean=a.grammarOptions.fixProcessLean||!1,this.hasGSPreload=b("FacebarGlobalOptions").hasGSPreload,this.gsPreloadOptions=b("FacebarGlobalOptions").gsPreloadParams,this.useGloballyCachedKeywords=b("FacebarGlobalOptions").useGloballyCachedKeywords,this.globallyCachedKeywordsTTL=b("FacebarGlobalOptions").globallyCachedKeywordsTTL,this.globallyCachedKeywordsUseCDN=b("FacebarGlobalOptions").globallyCachedKeywordsUseCDN,this.globallyCachedKeywordsUseDT=b("FacebarGlobalOptions").globallyCachedKeywordsUseDT,this.throttleExecuteQuery(),this.throttleSendRemoteQuery(),this.throttleRenderResults(),this.resultStoreOptions=a.grammarOptions||{},this.resultStoreOptions.useNewExactNameMatch=a.grammarOptions.useNewExactNameMatch==="true",this.defaultQuery=null,this._bypassBucketizer=!1,this._resultsBucketizer=new(b("ResultsBucketizer"))(b("ResultsBucketizerConfig").rules,function(a,b){switch(b){case"isSeeMore":return a.isSeeMore;case"objectType":return a.type;case"resultSetType":return a.results_set_type;case"renderType":return a.render_type||a.type;case"cacheOnlyResult":return a.cacheOnlyResult;case"closeEntity":return a.bootstrapped||(a.tags?a.tags[b]:void 0);default:return a.tags?a.tags[b]:void 0}}),this.fetchNullState(),this.initWithConfig(b("FacebarGlobalOptions").grammarConfig),this.subscribe("bootstrapped",function(){b("Arbiter").subscribe("FacebarDataSource.getBootstrapMatches",function(b,a){a.callback.call(null,this.getBootstrapMatches(a.query,a.whitelistedEntIds))}.bind(this))}.bind(this))}a.prototype.initWithConfig=function(a){this.facebarConfig=a,this.createResultStore(),this._fetched_null_state&&(this.setNullState(this._fetched_null_state),this._fetched_null_state=null)};a.prototype.throttleExecuteQuery=function(){var a=b("FacebarGlobalOptions").executeQueryThrottleTime;this.executeQueryThrottled=b("throttle").withBlocking(this.executeQuery,a,this)};a.prototype.throttleSendRemoteQuery=function(){var a=b("FacebarGlobalOptions").sendRemoteQueryThrottleTime;a===0?this.sendRemoteQueryThrottled=this.sendRemoteQuery:(b("FacebarGlobalOptions").typingSpeedThrottleTime>0&&(a=b("FacebarGlobalOptions").typingSpeedThrottleTime),this.sendRemoteQueryThrottled=b("throttle").withBlocking(this.sendRemoteQuery,a,this))};a.prototype.throttleRenderResults=function(){var a=b("FacebarGlobalOptions").renderThrottleTime;if(a===0){this.renderResultsThrottled=this.renderResults;return}var c=Date.now();this.renderResultsThrottled=function(b,d,e,f,g,h){var i=Date.now();(e||c+a<i)&&(c=i,this.renderResults(b,d,e,f,g,h))}.bind(this)};a.prototype.createResultStore=function(){this.facebarConfig.maxGrammarResults=this._maxGrammarResults,this.resultStore=new(b("FacebarResultStore"))(this.facebarConfig,b("FacebarTokenizer").tokenize,this.getEntry.bind(this),this.resultStoreOptions),this._fixProcessLean&&this._processLean(),this.subscribe("setSortFunction",function(a,b){this.resultStore.setSortFunction(b)}.bind(this))};a.prototype.dirty=function(){this._nullStateFetched=!1,this.resultStore.resetCaches(),h.dirty.call(this)};a.prototype.refreshNullstate=function(a,c){a===void 0&&(a=b("emptyFunction")),c===void 0&&(c=b("emptyFunction")),this._nullStateFetched=!1,this.fetchNullState(a,c)};a.prototype.addEntries=function(a){this.resultStore.addBootstrap(this.processEntries(a))};a.prototype._processLean=function(){__p&&__p();if(this._fixProcessLean){if(this._leanPayload&&this.resultStore){var a,b=this._leanPayload.entries;for(var c in b){a=this.getEntry(c);if(!a)continue;for(var d in b[c])a.grammar_costs||(a.grammar_costs={}),a.grammar_costs["{"+d+"}"]=b[c][d]}this.setExclusions(this._leanPayload.blocked);this._leanPayload=null}}else h._processLean.call(this)};a.prototype.setNullStateData=function(a,b){b&&(this.nullStateData={grammar_version:this.grammarVersion});Object.assign(this.nullStateData,a);return this};a.prototype.setNullState=function(a){__p&&__p();if(b("FacebarGlobalOptions").hasKeywordOnlyTypeahead){var c={};a.queries=a.queries.filter(function(a){a=a.parse.display.join(" ").toLowerCase();if(!c[a]){c[a]=!0;return!0}return!1})}this._null_state=a;this.processEntries(this._null_state.entities);this.resultStore.setNullState(this._null_state.queries);this.resultStore.addNullStateToQueryCache(this.getRawStructure(b("FacebarStructuredText").fromString("")))};a.prototype.getNullStateTrending=function(){return this._null_state.trending};a.prototype.setSingleState=function(a){this._single_state=a};a.prototype.getSingleState=function(){return this._single_state};a.prototype.setLocal=function(a){this._is_local=a};a.prototype.setCategoryName=function(a){this._categoryName=a};a.prototype.overrideNullState=function(a){this._null_state!=null||g(0,5553),this._original_null_state=this._original_null_state||this._null_state,this.setNullState(a)};a.prototype.restoreNullState=function(){this._original_null_state&&this.setNullState(this._original_null_state)};a.prototype.fetchNullState=function(a,c){__p&&__p();a===void 0&&(a=b("emptyFunction"));c===void 0&&(c=b("emptyFunction"));if(this._nullStateFetched){this.activityStart();setTimeout(this.activityEnd.bind(this),0);a();return}var d=new(b("AsyncRequest"))().setURI(this.nullStateEndpoint).setData(this.nullStateData).setMethod("GET").setReadOnly(!0).setAllowCrossPageTransition(!0).setHandler(function(b){this.resultStore?(this.setNullState(b.payload),this.inform("nullstateReady",!0)):this._fetched_null_state=b.payload,this._nullStateFetched=!0,a()}.bind(this)).setErrorHandler(function(){c()}).setFinallyHandler(this.activityEnd.bind(this));this.activityStart();d.send()};a.prototype.toTypeaheadEntryUid=function(a,c){__p&&__p();var d,e=b("FacebarStructuredText").fromStruct(c.structure),f=e.getFragment(0);if(e.getCount()==1&&f.isType("ent")){var g=f.getType().split(":")[2];d=this.getEntry(f.getUID(),g);d.type=this.resultStore.stripBrackets(c.type)}else d=this.getEntry(c.tuid),d||(d={dynamic_cost:c.dynamic_cost,extra_uri_params:c.extra_uri_params,memcache:c.fromMemcache,photo:c.photo,results_set_type:c.resultsSetType,tuid:c.tuid,type:c.type,uid:c.tuid,tags:c.tags},this.processEntries([d]),d=this.getEntry(c.tuid)),d.icon_class=c.iconClass,d.unseen_posts=c.unseen_posts,d.category=c.category,d.subtext=c.subtext,d.boldedSubtext=c.boldedSubtext,d.is_work_foreign_entity=c.is_work_foreign_entity;d.error_info=c.errorInfo;d.logInfo=c.logInfo;d.itemLoggingInfo=c.item_logging_info;d.itemLoggingId=c.item_logging_id;d.structure=e;d.text=d.structure.toString();d.queryTypeText=c.queryTypeText;d.semantic=!!c.isSingleState&&c.singleStateSemantic?c.singleStateSemantic:c.semantic;d.alternateSemantic=c.alternateSemantic;d.tree=c.tree;d.cost=c.cost;d.isSeeMore=!!c.isSeeMore;d.isNullState=!!c.isNullState;d.isSingleState=!!c.isSingleState;d.keywordSource=c.keywordSource;d.keyword=c.keyword;f=c.keyword_type;d.keywordType=f;d.isTrending=!!c.isTrending||c.keywordBootstrapType===b("FacebarJSConstants").keywordBootstrapTypes.trending||f===b("FacebarJSConstants").keywordTypes.trending;d.isCelebrity=f===b("FacebarJSConstants").keywordTypes.celebrity;d.isFootball=f===b("FacebarJSConstants").keywordTypes.football;d.isPhotos=f===b("FacebarJSConstants").keywordTypes.photos;d.isVideos=f===b("FacebarJSConstants").keywordTypes.videos;d.isHashtag=f===b("FacebarJSConstants").keywordTypes.hashtag;d.isLocal=f===b("FacebarJSConstants").keywordTypes.local||f===b("FacebarJSConstants").keywordTypes.local_category;d.isCompany=f===b("FacebarJSConstants").keywordTypes.company;d.isMovie=f===b("FacebarJSConstants").keywordTypes.movie;d.isHappeningNow=f===b("FacebarJSConstants").keywordTypes.happeningNow;d.isSpecialIntentGeneric=f===b("FacebarJSConstants").keywordTypes.specialIntentGeneric;d.isLink=f===b("FacebarJSConstants").keywordTypes.link;b("FacebarJSConstants").intentKeys.map(function(a){d.isSpecialIntent=d.isSpecialIntent||d[a]});d.isRecent=!!c.isRecent;d.isPrefetched=!!c.isPrefetched;d.isSuggestion=!!c.isSuggestion;d.isInjectedSuggestion=!!c.isInjectedSuggestion;d.isFromGSEF=!!c.isFromGSEF;d.isGloballyCachedKeyword=!!c.isGloballyCachedKeyword;d.entityInfo=c.entityInfo;d.cacheOnlyResult=c.cacheOnlyResult||!1;if(!b("FacebarGlobalOptions").workplaceHybridTypeahead&&b("FacebarGlobalOptions").hasKeywordOnlyTypeahead&&(!b("FacebarGlobalOptions").logSERPClickAsRecentSearch||!c.isNullState)){g=b("FacebarStructuredText").fromStruct(c.structure).toString().toLowerCase();e=b("FacebarKeywordSearchUtils").makeFacebarEntry(g);d.uri=e.uri;d.semantic=e.semantic;d.structure=e.structure}else d.uri=d.uri||b("FacebarURI").getURI(this.facebarConfig,d);d.type==="user"&&b("FacebarGlobalOptions").landUserSuggestionOnChat&&(d.uri=b("FacebarURI").getChatURI(d));d.parse=c.parse;d.tags=c.tags||{};d.isKeywordL2=c.isKeywordL2||!1;d.exactMatchKeyword=c.exactMatchKeyword||!1;d.qid=c.qid;d.templateID=c.templateID;c.isJSBootstrapMatch&&(d.isJSBootstrapMatch=c.isJSBootstrapMatch,d.backendCost=c.backendCost,d.bootstrapCost=c.bootstrapCost,d.keywordBootstrapType=c.keywordBootstrapType);this._replaceCategoryWithTermMatches(a,d,c);return d.tuid};a.prototype._replaceCategoryWithTermMatches=function(a,b,c){__p&&__p();if(b.type!=="user"&&b.type!=="page")return;if(!b.term_to_subtitle||!c.termMatches)return;var d=b.alias,e=d==null?"":this.resultStore._convertToAliasKey(d),f=[];c.termMatches.forEach(function(c){var d=b.term_to_subtitle[c];!a.is_alias_search&&c===e&&c!==a.potential_alias_term&&(d=null);d&&f.push(d)},this);b.category===void 0&&(b.category="");b.original_category!==void 0&&(b.category=b.original_category);if(!f||f.length===0)return;b.original_category===void 0&&(b.original_category=b.category);if(!b.original_category)return;d=b.original_category.length>0?b.original_category.split(" \xb7 "):[];d.unshift.apply(d,f);d=d.filter(function(a,b,c){return b==c.indexOf(a)});b.category=d.splice(0,2).join(" \xb7 ")};a.prototype.getRawStructure=function(a){typeof a==="string"&&(a=b("FacebarStructuredText").fromString(a));if(this.resultStore)return this.resultStore.transformStructured(a.toArray())};a.prototype.saveResult=function(a){this._initialQueryData=this.getUID(a.uid,a.fetchType)};a.prototype.isDefaultKeywordQuery=function(a){return a.type===b("FacebarJSConstants").keywordType&&b("FacebarResultStoreUtils").getTextFromResult(a).toLowerCase()===this.value.getHash().trim().toLowerCase()};a.prototype.buildUids=function(a){__p&&__p();if(!a||!this.resultStore)return[];typeof a==="string"&&(a=b("FacebarStructuredText").fromString(a));var c=this.getRawStructure(a);a=this.resultStore.getResults(c,this.getMaxResults());var d=a.results;if(d===void 0)return[];a=a.null_state===!0;var e=0;d=d.filter(function(a,c){return!b("FacebarGlobalOptions").allowGrammar&&a.type=="grammar"?!1:a.semantic!="<blank>"&&(a.type!="unimplemented"||e++===0)},this);var f=[],g=[],h=[];d.forEach(function(a){a.forcedPosition>0?h.push(a):a.isSeeMore?f.push(a):g.push(a)});a?d=this.orderNullState(d,b("FacebarGlobalOptions").maxNullstateResultCount?b("FacebarGlobalOptions").maxNullstateResultCount:this.getMaxResults()):d=g;h.length>0&&(h.sort(function(a,b){return a.forcedPosition-b.forcedPosition}),h.forEach(function(a){d.splice(a.forcedPosition,0,a)}));f.length>0&&d.push.apply(d,f);return d.map(function(a){return this.toTypeaheadEntryUid(c,a)}.bind(this))};a.prototype.orderNullState=function(a,b){var c={top:[],bottom:[],middle:[]},d=function(a){a=a.null_state_position;return Object.prototype.hasOwnProperty.call(c,a)?a:"middle"},e=function(a,b){return a.original_cost-b.original_cost};a&&a.forEach(function(a){c[d(a)].push(a)},this);for(var f in c)c[f]=c[f].sort(e).slice(0,b),b-=c[f].length;return[].concat(c.top,c.middle,c.bottom)};a.prototype.isEntity=function(a){return!a?!1:/^\d+$/.test(a)};a.prototype.handleResponse=function(a,b){a.payload.errors||(this.processEntries(a.payload.entities),a.payload.results.forEach(function(c){c.qid=a.queryId,c.parse||(c.parse={}),c.parse.entTokens=c.parse.entTokens||[],c.parse.remTokens=c.parse.remTokens||[],c.parse.suffix=c.parse.suffix||"",this.isEntity(c.semantic)&&(c=this._buildCommonEntityFields(c,b.tokens))}.bind(this)),this.saveResults(a,b))};a.prototype.saveResults=function(a,b){a.payload.prefetched&&this.processPrefetched(a.payload.prefetched),this.resultStore.saveResults(a.payload.results,b,a.payload.incomplete,{},[])};a.prototype.processPrefetched=function(a){var c=this,d=function(d){var e=b("FacebarStructuredText").fromString(d),f=c.getRawStructure(e);e=a[d];c.processEntries(e.entities);e.results.forEach(function(a){this.isEntity(a.semantic)&&(a=this._buildCommonEntityFields(a,f.tokens))}.bind(c));c.resultStore.saveResults(e.results,f,e.incomplete)};for(var e in a)d(e)};a.prototype.processEntries=function(a){__p&&__p();return a.map(function(a,b){__p&&__p();var c=a.uid+="";a.textToIndex=this.getTitleTerms(a);a.titleToIndex=this.getTitleTerms(a);c=this.getUID(c,a.fetchType);var d=this.getEntry(c);!d?(this.setEntry(c,{}),d=this.getEntry(c)):delete a.photo;Object.assign(d,a);d.tuid=c;d.index===void 0&&(d.index=b);return c},this)};a.prototype.getUID=function(a,b){a+="";if(b!==void 0){b=/([^:]+:)?([^:]+)(:.*)?/.exec(b)[2];return JSON.stringify([a,b])}return a};a.prototype.getEntry=function(a,b){a=""+a;b=b!=null?h.getEntry.call(this,this.getUID(a,b))||h.getEntry.call(this,a):h.getEntry.call(this,a);return b};a.prototype.getEntryForFragment=function(a){return this.getEntry(a.getUID(),a.getTypePart(2))};a.prototype.getMaxResults=function(){return this._numResults.max};a.prototype.query=function(a,c,d){this.executeQueryThrottled(a,this._initialQueryData,{keyPress:b("FacebarTimerUtils").getTimestamp()}),this._initialQueryData=null};a.prototype.shouldFetchMore=function(a,c){__p&&__p();if(!a.is_empty){var d=c.filter(function(a){return a.type===b("FacebarJSConstants").keywordType}).length;if(d<b("FacebarGlobalOptions").default_num_top_results_to_show)return!0}if(a.is_empty)return!1;if(this.resultStore.alreadyKnown(a.cache_id))return!1;if(a.raw_text&&this._isQueryTooShort(a.raw_text))return!1;return c.length<this.getMaxResults()||this._performShortQuery?!0:this.countValidResults(c)<this.getMaxResults()||this._performShortQuery};a.prototype.countValidResults=function(a){var b=0;a.forEach(function(a){a&&!a.isNullState&&!a.isSeeMore&&b++},this);return b};a.prototype.handleQueryResponse=function(a,c,d,e,f,g,h){__p&&__p();var i=g||h;if(i&&a.payload.is_user)return;var j=a.payload;a.queryId=c;a.inputQuery=d.text_form;j.results!=null&&j.results.forEach(function(a){a.isSingleState=this._single_state,a.isFromGSEF=g,a.isGloballyCachedKeyword=h}.bind(this));f!=null&&(f.endRemoteQuery=b("FacebarTimerUtils").getTimestamp());this.inform("response_received",a);this.handleResponse(a,d);c=[];j.abandon_cache&&(c=j.results.map(function(a){return this.toTypeaheadEntryUid(d,a)}.bind(this)));var k=j.num_topresults_to_show;(k==null||k<3)&&(k=3);this.respond(e,c,!0,j&&(!j.results||j.results.length===0),f,k,i);this.inform("backend_response",a)};a.prototype.activityStart=function(){this._waitingQueries||this.inform("activity",{activity:!0},"state"),this._waitingQueries++};a.prototype.activityEnd=function(){this._waitingQueries--,this._waitingQueries||this.inform("activity",{activity:!1},"state")};a.prototype._bucketizeResults=function(a,b,c){b=this._tagKeywordsSuggestions(b);return this._resultsBucketizer.bucketize(b,i,null,c)};a.prototype._tagKeywordsSuggestions=function(a){__p&&__p();if(!a||a.length===0)return a;var c=a[0];if(c.bootstrapped)return a;return c.type==="grammar"||c.cost<b("FacebarGlobalOptions").closeEntityThreshold&&c.type==="user"?a:a.map(function(a){if(a.type!==b("FacebarJSConstants").keywordType)return a;a=babelHelpers["extends"]({},a);a.tags.topBucket=!0;return a})};a.prototype._buildCommonEntityFields=function(a,c){if(a.queryTypeText)return a;a.parse.display=[{type:"ent:"+a.type,uid:a.semantic}];a.parse.fetchType&&(a.parse.display[0].fetchType=a.parse.fetchType);a.parse.entTokens=c;a.parse.pos=0;a.resultsSetType="{"+a.type+"}";a.queryTypeText=b("FacebarJSConstants").defaultQueryTypeText;return a};a.prototype.setBypassBucketizer=function(a){this._bypassBucketizer=a};a.prototype.respond=function(a,c,d,e,f,g,h){__p&&__p();d&&this.value&&(typeof this.value==="string"&&(this.value=b("FacebarStructuredText").fromString(this.value)),this.inform("remote_query_match",{isMatch:this.value.matches(a),queryId:f!=null?f.queryId:0}),a=this.value,(!c||c.length===0)&&(c=this.buildUids(a)));this.inform("reorderResults",c);this.inform("respondValidUids",c);c=c.map(this.getEntry,this);c.forEach(function(a,b){a.fromCache=!d,a.isSingleState=this._single_state},this);if(!d&&(a.getHash().length<512||a.getHash().startsWith("http://")||a.getHash().startsWith("https://"))){var i=this.getRawStructure(a);this.shouldFetchMore(i,c)&&(f!=null&&(f.dispatchRemoteQuery=b("FacebarTimerUtils").getTimestamp()),this.useGloballyCachedKeywords&&!this._single_state?(this.sendRemoteQueryThrottled(i,a,f,!1,null,!0),this.sendRemoteQueryThrottled(i,a,f)):this.hasGSPreload?(this.sendRemoteQueryThrottled(i,a,f,!0,this.gsPreloadOptions.max_entities_to_fetch),this.sendRemoteQueryThrottled(i,a,f)):this.sendRemoteQueryThrottled(i,a,f))}(!d||f==null||f.queryId===this._maxRemoteQueryId)&&this.renderResultsThrottled(a,c,d,e,g,h);f!=null&&this.logLatencies(d,f)};a.prototype.injectExtraResults=function(a,c,d){b("FacebarFindPeopleAndPages").insertInto(a,c,!d,this._single_state),b("FacebarInviteCoworkers").insertInto(a,c,!d,this._single_state)};a.prototype.logLatencies=function(a,c){var d=b("FacebarTimerUtils").getTimestamp();a?this.inform("remote_query_latency",{queryId:c.queryId,latencies:{queryStart:Math.max(c.startRemoteQuery-c.dispatchRemoteQuery,0),queryEnd:Math.max(c.endRemoteQuery-c.startRemoteQuery,0),keyPressToQueryDispatch:Math.max(c.dispatchRemoteQuery-c.keyPress,0),keyPressToQueryStart:Math.max(c.startRemoteQuery-c.keyPress,0),keyPressToQueryEnd:Math.max(c.endRemoteQuery-c.keyPress,0),render:Math.max(d-c.endRemoteQuery,0),inflightRequests:c.inflightRequests,waitingQueries:c.waitingQueries,keyPressToRender:Math.max(d-c.keyPress,0)}}):this.inform("cache_query_latency",{queryId:c.queryId,latencies:{queryStart:Math.max(c.startCacheQuery-c.keyPress,0),queryEnd:Math.max(c.endCacheQuery-c.startCacheQuery,0),keyPressToQueryEnd:Math.max(c.endCacheQuery-c.keyPress,0),render:Math.max(d-c.endCacheQuery,0),keyPressToRender:Math.max(d-c.keyPress,0)}})};a.prototype._updateMaxResults=function(){b("queryThenMutateDOM")(function(){var a=b("Vector").getViewportDimensions().y,c=b("ViewportBounds").getTop()||42,d=56,e=48;a=a-c-e-25;this._maxResults=Math.max(this._numResults.min,Math.min(this._numResults.max,Math.floor(a/d)-1));this.value&&this.query(this.value)}.bind(this))};a.prototype.getCurQueryId=function(){return this._curQueryId};a.prototype.setMinQueryLength=function(a){this._minQueryLength=a};a.prototype.setGrammarOption=function(a){b("FacebarGlobalOptions").allowGrammar=a};a.prototype.getBootstrapMatches=function(a,c){c===void 0&&(c=[]);var d=this.getRawStructure(b("FacebarStructuredText").fromString(a));a=this.resultStore.getBootstrapMatches(d,c);return a.map(function(a){return this.getEntry(this.toTypeaheadEntryUid(d,a))}.bind(this))};Object.assign(a.prototype,{events:["query","respond","bootstrapped","activity","ready"]});e.exports=a}),null);
__d("FacebarTypeahead",["Arbiter","Typeahead","emptyFunction"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g;c=babelHelpers.inherits(a,b("Typeahead"));g=c&&c.prototype;function a(a,c,d,e,f,h){g.constructor.call(this,a,c,d,e);this.getCore();this.proxyEvents();this.initBehaviors(f||[]);var i=this.core.subscribe("focus",function(){h&&h.init(this),this.core.unsubscribe(i),this.data.bootstrap(!1),this.core.input.focus()}.bind(this));this.data.bootstrap(!0);this.inform("init",this,"persistent");b("Arbiter").inform("Facebar/init",this,"persistent")}a.prototype.proxyEvents=function(){var a,b=[],c=null,d=function(){while(a=b.shift())this.inform(a[0],a[1]);c=null}.bind(this);[this.data,this.view,this.core].forEach(function(a){a.subscribe(a.events,function(a,e){b.push([a,e]),c=c||setTimeout(d,0)}.bind(this))},this)};Object.assign(a.prototype,{init:b("emptyFunction")});e.exports=a}),null);
__d("FacebarTypeaheadCore",["csx","cx","invariant","Arbiter","ArbiterMixin","Base64","CSS","DOM","Event","FacebarGlobalOptions","FacebarJSConstants","FacebarKeywordSearchUtils","FacebarResultStoreUtils","FacebarStructuredText","FacebarTypeaheadInput","FacebarURI","Keys","KeywordsSearchResultConfig","Parent","URI","WorkGalahadNavStore","WorkplaceSearchTypeaheadConfigs","generateBrowseSessionID","getActiveElement","gkx","immutable","mixin"],(function(a,b,c,d,e,f,g,h,i){"use strict";__p&&__p();var j;c=babelHelpers.inherits(a,b("mixin")(b("ArbiterMixin")));j=c&&c.prototype;function a(a){j.constructor.call(this),this.events=["session","focus","select","change","execute","blur","focusStartTime","open"],this._squashedEntityIDsByQuery=b("immutable").Map(),Object.assign(this,a)}a.prototype.init=function(a,c,d){__p&&__p();if(window.getSelection===null)throw new Error("Facebar: window.getSelection is null!");this.init=function(){};this.data=a;this.view=c;this.root=d;this.facebarRoot=b("Parent").bySelector(d,"._585-");this.button=b("DOM").find(this.facebarRoot,"._4w98");this.windowFocused=!0;this.isFocused=!1;this.hoverAnimation=null;this.stickyQuery=null;this.settedQuery=null;this.selectedQuery=null;this.currentQuery=null;this.isSuggestionBagdeVisible=!1;this.initSubcomponents();this.initEvents();this.checkValue();this.checkSingleState();this.checkLocal();this.checkCategoryName()};a.prototype.initSubcomponents=function(){var a=b("DOM").find(this.root,"._5861");this.input=new(b("FacebarTypeaheadInput"))(a);this.view.setInputElement(this.input.getRawInputElement())};a.prototype.initEvents=function(){b("Event").listen(this.root,"keydown",this.keydown.bind(this)),b("Event").listen(this.root,"keyup",this.keyup.bind(this)),b("Event").listen(this.root.parentNode,"mousedown",this.mousedown.bind(this)),this.view.onMousedown(this.viewMousedown.bind(this)),b("Event").listen(window,"focus",this.focusWindow.bind(this)),b("Event").listen(window,"blur",this.blurWindow.bind(this)),this.view.subscribe("select",this.selectView.bind(this)),this.view.subscribe("highlight",this.highlightView.bind(this)),this.view.subscribe("render",this.highlightView.bind(this)),this.input.subscribe("focus",this.focusInput.bind(this)),this.input.subscribe("blur",this.blurInput.bind(this)),this.input.subscribe("change",this.changeInput.bind(this)),this.data.subscribe("activity",this.typeaheadActivity.bind(this)),this.data.subscribe("respond",this.completeData.bind(this)),this.data.subscribe("nullstateReady",this.performQueryIfVisible.bind(this)),b("Arbiter").subscribe("FacebarTypeahead.clearRecentSearches",function(){return this.clearRecentSearches()}.bind(this)),b("Event").listen(this.button,"click",this.buttonDownOrClick.bind(this)),b("Event").listen(this.button,"mousedown",this.buttonDownOrClick.bind(this)),b("Event").listen(this.button,"mouseup",this.buttonUp.bind(this)),setTimeout(this.initFocus.bind(this),0)};a.prototype.initFocus=function(){!this.lazyFocused&&b("DOM").contains(this.input.root,b("getActiveElement")())&&(this.lazyFocused=!0,this.isFocused=!0,this._newSession(),this.inform("focus",{catchup:!0}),this.open(!0))};a.prototype.setStartTime=function(a){this.inform("focusStartTime",{time:a})};a.prototype.cleanQuery=function(a){a=babelHelpers["extends"]({},a)||{};a.structure||(a.structure=new(b("FacebarStructuredText"))());(!b("FacebarGlobalOptions").allowGrammar||b("FacebarJSConstants").nonGrammarTypes[a.type])&&(a.structure=b("FacebarStructuredText").fromString(a.structure.toString()));a.structure instanceof b("FacebarStructuredText")||i(0,3869);return a};a.prototype._unlockQuery=function(){var a=this.input.getValue();a.hasType("ent")&&a.trim().getCount()===1&&(this.input.storeSelection(),this.input.setValue(b("FacebarStructuredText").fromString(a.toString())),this.input.restoreSelection())};a.prototype.setPageQuery=function(a){a=this.cleanQuery(a);var b=this.input.getValue(),c=a.structure;b=!c.isEmptyOrWhitespace()&&(b.isEmptyOrWhitespace()||!b.matches(c));return this.selectQuery(a,b)};a.prototype.selectQuery=function(a,b){b=b!==!1;a=this.cleanQuery(a);(b||!this.selectedQuery)&&((b||this.getValue().isEmptyOrWhitespace())&&this.setQuery(a),this.selectedQuery=a);return a};a.prototype.completeSelection=function(){var a=this.view.getSelection();if(a&&!a.search){this.data.saveResult(a);a.structure=a.structure.pad();this.setQuery(a);return!0}return!1};a.prototype.setQuery=function(a,c){c===void 0&&(c=!0),a=this.cleanQuery(a),a.structure.hasType("blank")&&(a.structure=new(b("FacebarStructuredText"))(a.structure.toArray().filter(function(a){return a.getType()!="blank"}))),this.input.setValue(a.structure),this.settedQuery=a,this.stickyQuery=c===!1?this.stickyQuery:a,this.checkValue(),this.checkSingleState(),this.checkLocal(),this.checkCategoryName()};a.prototype.checkValue=function(a){a===void 0&&(a=!1);if(!a&&this.value&&this.value.getHash()===this.input.getValue().getHash())return;this.performQueryIfVisible();this.showSearchSuggestionBadgeIfPossible()};a.prototype.showSearchSuggestionBadgeIfPossible=function(){this.isNullState()?!this.isSuggestionBagdeVisible&&this.data.resultStore.injectedSuggestionCount&&(b("Arbiter").inform("FacebarTypeahead.showSuggestionBadge"),this.isSuggestionBagdeVisible=!0):this.isSuggestionBagdeVisible&&(b("Arbiter").inform("FacebarTypeahead.hideSuggestionBadge"),this.isSuggestionBagdeVisible=!1)};a.prototype.checkSingleState=function(){var a=this.input.getValue();this.data.setSingleState(a.getCount()===1&&a.hasType("ent"))};a.prototype.checkLocal=function(){var a=this.input.getValue();this.data.setLocal(a.getCount()===1&&a.isLocal())};a.prototype.checkCategoryName=function(){var a=this.input.getValue();a.getCategoryName()!==null&&this.data.setCategoryName(a.getCategoryName())};a.prototype.isNullState=function(){return this.input.getValue().getHash()===""};a.prototype.performQueryIfVisible=function(){if(!this.view.visible)return;this.performQuery()};a.prototype.performQuery=function(){this.value=this.nextQuery=this.getValue(),this.view.resetIndex(),this.data.query(this.nextQuery),this.currentQuery=this.nextQuery};a.prototype.executeQuery=function(a){this._browseSessionID=b("generateBrowseSessionID")({appName:"www",edge:"keywords_search"});var c=this.isNullState();a=this.cleanQuery(a);this._setSquashedEntityIDsFromQuery(a);var d=this.inform("execute",a),e=this.getSessionID();this.close();b("FacebarGlobalOptions").allowGrammar?this.selectQuery(a):this.selectQuery();a.type!=="shortcut"&&(!c||a.isInjectedSuggestion)&&(this.data.resultStore.addRecentEntryToNullState(a),a.isInjectedSuggestion&&(b("Arbiter").inform("FacebarTypeahead.removeInjectedSuggestion"),--this.data.resultStore.injectedSuggestionCount,this.performQuery()));d||this._navigateToQuery(a,e,a.csid)};a.prototype.getSearchType=function(){return"facebar"};a.prototype._newSession=function(){if(this._sessionID!=null)return;this._sessionID=Math.random().toString();this.inform("session",this._sessionID,"state")};a.prototype._closeSession=function(){this._sessionID=null,this.inform("session",null,"state")};a.prototype.getSessionID=function(){return this._sessionID};a.prototype.getBrowseSessionID=function(){return this._browseSessionID};a.prototype._navigateToQuery=function(a,c,d){__p&&__p();var e=this.data.facebarConfig;if(a.uri){a.uri.addQueryData(a.extra_uri_params);a.uri.addQueryData({ref:"br_tf"});var f=a.uid!=null&&a.uid.match(/^[0-9]+$/)!=null;if(a.structure&&(a.type=="websuggestion"||a.type==b("KeywordsSearchResultConfig").result_type||a.type=="grammar"&&(!e||String(a.uri.getPath()).startsWith(e.search_path))||b("FacebarGlobalOptions").hasKeywordOnlyTypeahead&&f)){e=this.data.getRawStructure(a.structure).text_form;f=b("Base64").encode(encodeURIComponent(e)).replace(/\=+$/,"");e={sid:c,qs:f,gv:this.data.getQueryData().grammar_version,ent_ids:this.getSquashedEntityIDsFromQueryString(String(a)),bsid:this._browseSessionID,preloaded_entity_ids:null,preloaded_entity_type:null,ref:"br_tf",csid:null,high_confidence_argument:null,client_time_ms:Date.now()};d&&(e.csid=d);a.uri.addQueryData({ref:b("FacebarKeywordSearchUtils").encodeFacebarURIParams(e),bs:a.alternateSemantic})}a.uri.addQueryData({epa:"SEARCH_BOX"});b("WorkplaceSearchTypeaheadConfigs").unifySearchBox&&b("WorkGalahadNavStore").getSelectedAppTabID()==="chats"&&a.type==="user"&&(a.uri=b("FacebarURI").getChatURI(a));a.uri.go();return}};a.prototype.reset=function(){this.selectQuery(),this.inform("reset"),this.showSearchSuggestionBadgeIfPossible(),b("FacebarKeywordSearchUtils").clearSelectedTabInfo()};a.prototype.open=function(a){this.view.show(this.facebarRoot.offsetWidth),this.input.focus({catchup:a}),this.checkValue(!0),this.checkSingleState(),this.checkLocal(),this.checkCategoryName(),this.highlightButton(),this.isFocused||(this.isFocused=!0,this._newSession(),this.inform("focus")),this.inform("open",{catchup:a,sessionID:this._sessionID})};a.prototype.close=function(){__p&&__p();this._closeSession();if(this.inform("close")===!1)return;(!this.value||this.value.isEmptyOrWhitespace())&&this.selectedQuery?this.input.setValue(this.selectedQuery.structure):this.stickyQuery&&this.input.setValue(this.stickyQuery.structure);this.input.setHint(null);this.view.hide();this.view.setAutoSelect(!1);this.inform("session",null,"state");this.isFocused=!1;this.unlightButton()};a.prototype.getElement=function(){return this.root};a.prototype.getValue=function(){return this.input.getValue()};a.prototype.getText=function(){return this.getValue().toString()};a.prototype.submitQuery=function(a){__p&&__p();if(this.view.index<0){var c=this.input.getValue(),d=this.data.getRawStructure(c);if(d&&!d.is_empty){d=d.raw_text?d.raw_text:b("FacebarResultStoreUtils").getRawTextFromStructured(c.toArray());c=b("FacebarKeywordSearchUtils").makeFacebarEntry(d);c.position=a;this.inform("magSearch",c);this.executeQuery(c)}}else this.view.select()};a.prototype.keydown=function(a){__p&&__p();var c=!0,d=b("Event").getKeyCode(a);a.metaKey===!0&&(this.metaOnKeyDown=!0);this.isFocused||this.open();switch(d){case b("Keys").ESC:b("gkx")("817376")?(this.selectQuery(),this.view.highlight(-1)):this.input.blur();break;case b("Keys").UP:this.view.prev();break;case b("Keys").DOWN:this.view.next();break;case b("Keys").RETURN:var e=-2;this.submitQuery(e);break;case b("Keys").PAGE_UP:this.view.first();break;case 222:e=this.input.value.trim();!a.getModifierState("shift")&&e.endsOnType("ent")&&this.input.setValue(e);c=!1;break;default:if(b("gkx")("817376")){if(d===b("Keys").LEFT||d===b("Keys").RIGHT){this.view.getSelection()==null?c=!1:d===b("Keys").LEFT?this.view.prevColumn():this.view.nextColumn();break}}else if(d===b("Keys").RIGHT){c=this.input.isSelectionAtEnd()&&this.completeSelection();break}e=d<=46&&d!==8&&d!==32;var f=d>=112&&d<=126,g=d===144||d===145;d=d===91||d===92||d===93||d===224;!e&&!f&&!g&&!a.metaKey&&!d&&(this.data.setSingleState(!1),this.data.setLocal(!1));this.stickyQuery=null;c=!1;break}this.input.storeSelection();c?(a.preventDefault(),a.stopPropagation()):b("gkx")("817376")&&this.view.highlight(-1)};a.prototype.keyup=function(a){var c=b("Event").getKeyCode(a),d=c<=46&&c!==8&&c!==32,e=c>=112&&c<=126,f=c===144||c===145;c=c===91||c===92||c===93||c===224;!d&&!e&&!f&&!a.metaKey&&!c&&!this.metaOnKeyDown&&this._unlockQuery();c||(this.metaOnKeyDown=!1)};a.prototype.mousedown=function(a){this.input.storeSelection()};a.prototype.viewMousedown=function(a){this.mousedown(a),a.preventDefault()};a.prototype.focusWindow=function(){this.windowFocused=!0};a.prototype.blurWindow=function(){this.windowFocused=!1};a.prototype.selectView=function(a,c){__p&&__p();if(!c||!c.selected)return;a=this.cleanQuery(c.selected);if(this.view.getCurrentColumnIndex()>0){var d=b("DOM").scry(c.element,'[role="gridcell"]')[this.view.getCurrentColumnIndex()];d=b("DOM").find(d,"a");d.click();return}this.inform("select",c);this.executeQuery(a)};a.prototype.highlightView=function(){var a=this.view.getSelection();this.input.setHint(a?a.structure:null)};a.prototype.blurInput=function(){setTimeout(function(){(this.windowFocused||b("URI").getRequestURI().getSubdomain()==="apps")&&(this.input.togglePlaceholder(),this.close())}.bind(this),0)};a.prototype.changeInput=function(){this.inform("change"),this.checkValue(),this.checkLocal(),this.inform("change_end")};a.prototype.focusInput=function(){this.open(),this.input.togglePlaceholder(!1)};a.prototype.updateData=function(){this.view.setLoading(this.loading)};a.prototype.completeData=function(a,b){if(b.forceDisplay||this.value&&this.value.matches(b.value)){a=!b.results.length;this.view.render(b.value,b.results,b.isAsync,a);this.tabQueued&&this.completeSelection()&&delete this.tabQueued}};a.prototype.typeaheadActivity=function(a,b){this.fetching=b.activity,this.loading!==this.fetching&&(this.loading=this.fetching,this.updateData())};a.prototype.getNameTextFromSelected=function(){var a=this.settedQuery&&this.settedQuery.semantic,b=this.data.facebarConfig&&this.data.facebarConfig.name_functions;a=a&&b&&a.match(/[a-z-]+\([^()]+\)/g);if(a)for(var c=0;c<a.length;c++){var d=a[c].match(/([a-z-]+)\(([^()]+)\)/);if(d&&b.includes(d[1]))return d[2]}return this.value.toString()};a.prototype.clearRecentSearches=function(){this.data.resultStore.clearRecentSearches()};a.prototype.highlightButton=function(){b("CSS").addClass(this.button,"_4w97")};a.prototype.unlightButton=function(){b("CSS").matchesSelector(this.button,"._4w97")&&b("CSS").removeClass(this.button,"_4w97")};a.prototype.buttonDownOrClick=function(a){a.preventDefault()};a.prototype.buttonUp=function(){!this.isFocused?this.focusInput():this.submitQuery(-1)};a.prototype._setSquashedEntityIDsFromQuery=function(a){var b=[];a.itemLoggingInfo?a.itemLoggingInfo.kwEntIds?b=a.itemLoggingInfo.kwEntIds:a.itemLoggingInfo.kwEntId&&(b=[a.itemLoggingInfo.kwEntId]):a.entity_ids&&(b=a.entity_ids);this._squashedEntityIDsByQuery=this._squashedEntityIDsByQuery.set(a.text,b)};a.prototype.getSquashedEntityIDsFromQueryString=function(a){a=this._squashedEntityIDsByQuery.get(a);return a==null?[]:a};a.clearRecentSearches=function(){b("Arbiter").inform("FacebarTypeahead.clearRecentSearches")};e.exports=a}),null);
__d("FacebarTypeaheadView",["csx","cx","fbt","Arbiter","ContextualLayer","ContextualLayerUpdateOnScroll","CSS","DOM","FacebarGlobalOptions","FacebarJSConstants","FacebarStructuredText","FacebarTypeaheadGSV2List.react","Parent","React","ReactDOM","ScriptPath","Style","SubscriptionList","TypeaheadView","WorkGalahadAppTabID","WorkGalahadNavActions","WorkWebDriverConstants","performanceNow"],(function(a,b,c,d,e,f,g,h,i){"use strict";__p&&__p();var j,k="unimplemented";c=babelHelpers.inherits(a,b("TypeaheadView"));j=c&&c.prototype;function a(a,c){j.constructor.call(this,a,c),this.handleClearHighlight=function(){this.highlight(this.getDefaultIndex(),!1)}.bind(this),this.handleHighlight=function(a){this.highlight(this.getIndexOf(a,this.results),!1)}.bind(this),this.handleSelect=function(a){this.handleHighlight(a),this.select(!0)}.bind(this),this.handleRender=function(){this.items=this.getItems()}.bind(this),this.isGalahadEnabled=Boolean(c.isGalahadEnabled),this.isNewClassicSearch=Boolean(c.isNewClassicSearch),this.element=a,this.sid="",this.index=-1,this.warningShown=!1,this.autoSelect=!1,this.flipCount=0,this.loading=!1,this.events=["highlight","render","filter","show"],this.mousedownSubscriptions=new(b("SubscriptionList"))()}a.prototype.init=function(){this.initializeElements()};a.prototype.onMousedown=function(a){this.mousedownSubscriptions.add(a)};a.prototype.initGSV2Elements=function(){this.element,this.results=[],this.keywordResults=[],this.entityResults=[]};a.prototype.initializeElements=function(){var a=this.element;Event.listen(this.element,"mousedown",function(a){return this.mousedownSubscriptions.fireCallbacks(a)}.bind(this));this.entityTop=!1;this.content=b("DOM").find(a,"._21r");this.warningNode=b("DOM").find(a,"._553e");this.resultsContainer=b("DOM").create("div");this.initGSV2Elements()};a.prototype.initializeList=function(){this.renderTypeaheadList(),this.content.appendChild(this.resultsContainer)};a.prototype.initializeLayer=function(){this.layer=new(b("ContextualLayer"))({context:b("Parent").bySelector(this.causalElement,"._585-"),position:"below",causalElement:this.causalElement,shouldSetARIAProperties:!1,"data-testid":b("WorkWebDriverConstants").SEARCH_TYPEAHEAD_VIEW},this.element).enableBehavior(b("ContextualLayerUpdateOnScroll"));var a=this.layer.getRoot();a.setAttribute("role","grid");a=this.layer.getContentRoot();this.root=b("DOM").find(a,"._50c9");b("CSS").addClass(a,"_5tlx");b("CSS").addClass(a,"_5xzd");this.wrapper=a};a.prototype.setInputElement=function(a){this.setAccessibilityControlElement(a),this.causalElement=a,this.isGalahadEnabled||this.initializeLayer(),this.initializeList()};a.prototype.setAutoSelect=function(a){this.autoSelect=a,this.index===-1&&a&&this.first()};a.prototype.getIndexOf=function(a,b){for(var c=0;c<b.length;c++)if(a.semantic===b[c].semantic&&a.isSeeMore===b[c].isSeeMore&&a.text===b[c].text)return c;return-1};a.prototype.show=function(a){if(!this.visible){!this.isGalahadEnabled?(this.inform("beforeShow",this.layer),b("Style").set(this.wrapper,"minWidth",a+"px")):b("WorkGalahadNavActions").selectAppTabID(b("WorkGalahadAppTabID").SEARCH);a=j.show.call(this);this.first();this.isGalahadEnabled||(this.layer.show(),this.layer.updatePosition());this.inform("show");b("Arbiter").inform("layer_shown",{type:"FacebarTypeahead"});return a}};a.prototype.hide=function(){this.visible&&(this.isGalahadEnabled||this.layer.hide(),j.hide.call(this),this.inform("hide"),b("Arbiter").inform("layer_hidden",{type:"FacebarTypeahead"}),this.flipCount=0);return this};a.prototype.select=function(a){var c=this.results&&this.results[this.index];if(!c){this.inform("quickSelect");return}c=this.inform("beforeSelect",{index:this.index,selected:c});c!==!1&&(b("ScriptPath").setClickPointInfo({click:"Search"}),j.select.call(this,a))};a.prototype.doesResultBelongToEntitySection=function(a){if(b("FacebarGlobalOptions").hasKeywordOnlyTypeahead||b("FacebarGlobalOptions").workplaceHybridTypeahead)return!0;switch(a.type){case b("FacebarJSConstants").keywordType:return!!a.isRecent;case b("FacebarJSConstants").grammarType:return a.tags&&a.tags.displayedSeeMore;default:return!0}};a.prototype.processGSV2Results=function(a){this.keywordResults=[];this.entityResults=[];var b=[],c=[],d=[],e=a.some(function(a){return a.isSingleState});a.forEach(function(a){this.doesResultBelongToEntitySection(a)?this.entityResults.push(a):e?a.alternateSemantic?c.push(a):a.exactMatchKeyword?d.push(a):b.push(a):this.keywordResults.push(a)}.bind(this));e&&(this.keywordResults=d.concat(c.concat(b)));return this.entityTop?this.entityResults.concat(this.keywordResults):this.keywordResults.concat(this.entityResults)};a.prototype.buildResultsData=function(a,c){__p&&__p();var d=String(this.value);a.forEach(function(a){a.query_string=d});this.results=a;b("FacebarGlobalOptions").disableKeywords&&(a=a.filter(function(a){return a.semantic!=null&&a.semantic.match(/^[0-9]+$/)!=null}));this.results=this.processGSV2Results(a);if(this.seeMoreResult){a=this.results.indexOf(this.seeMoreResult);a>-1&&this.results.splice(a,1);this.seeMoreResult=null}!this.isNullState()&&!c&&(this.seeMoreResult=this.inform("seeMore",{value:d,results:this.results}),this.seeMoreResult&&(this.isGalahadEnabled?this.results.unshift(this.seeMoreResult):this.results.push(this.seeMoreResult),this.inform("afterSeeMore",{results:this.results})))};a.prototype.buildResultsNoRegeneration=function(a,c){this.buildResultsData(a,c);a=b("performanceNow")();this.renderTypeaheadList({results:this.results,loading:this.loading});this.inform("logPerformanceTiming",{field:"build_results_set_props_duration",value:b("performanceNow")()-a})};a.prototype.buildResults=function(a){var b=a.some(function(a){return a.isSingleState});this.buildResultsNoRegeneration(a,b);return this.resultsContainer};a.prototype.getGSV2Items=function(){return j.getItems.call(this).filter(function(a){return!b("CSS").matchesSelector(a,"._3su")})};a.prototype.getItems=function(){return this.getGSV2Items()};a.prototype.render=function(a,c,d,e){this.inform("filter",{results:c,value:a});var f=!a||a instanceof b("FacebarStructuredText")&&a.isEmptyOrWhitespace();this.isGalahadEnabled||b("CSS").conditionClass(this.wrapper,"_5qz2",!c.length&&f);var g=c[0];e&&!f||(g&&g.results_set_type===k?g.error_info.suppress||this.showWarning(g.error_info.errorMessage||i._("This search isn't currently supported.")):this.hideWarning());c=c.filter(function(a){return a.results_set_type!==k});j.render.call(this,a,c,d)};a.prototype.reset=function(){this.index=-1;this.items=[];this.results=[];this.value="";this.buildResults([]);this.inform("reset");return this};a.prototype.resetIndex=function(){this.index=this.getDefaultIndex()};a.prototype.showWarning=function(a){b("CSS").show(this.warningNode),b("DOM").setContent(this.warningNode,a),this.warningShown=!0,this.highlight(-1,!1)};a.prototype.hideWarning=function(){b("CSS").hide(this.warningNode),this.warningShown=!1,this.highlight(this.index,!1)};a.prototype.setLoading=function(a){this.loading!=a&&(this.loading=a,this.renderTypeaheadList({results:this.results,loading:a}))};a.prototype.first=function(){this.index=this.autoSelect?0:-1,this.highlight(this.index)};a.prototype.prev=function(){(this.index<0||this.index===0&&this.autoSelect)&&(this.index=this.items.length),this.ignoreMouseover=!0,j.prev.call(this)};a.prototype.next=function(){this.autoSelect&&this.index>=this.items.length-1&&(this.index=-1),this.ignoreMouseover=!0,j.next.call(this)};a.prototype.$FacebarTypeaheadView1=function(a,b){var c=this.results.length-1;a>c?a=-1:a<-1&&(a=c);this.index=a;c={controlledHighlight:!0,highlightedResult:this.results[this.index],loading:this.loading,results:this.results};b&&this.inform("highlight",{index:a,selected:this.results[a]});this.visible&&this.renderTypeaheadList(c)};a.prototype.highlight=function(a,b){if(this.isNewClassicSearch)this.$FacebarTypeaheadView1(a,b!==!1);else{b=b!==!1&&this.index!==a;var c=this.warningShown||!this.autoSelect?-1:0;j.highlight.call(this,Math.max(c,a),b)}};a.prototype.isNullState=function(){return!String(this.value).trim()};a.prototype.copyProps=function(a){return babelHelpers["extends"]({accessibilityElement:this.accessibilityElement,onClearHighlight:this.handleClearHighlight,onHighlight:this.handleHighlight,onRender:this.handleRender,onSelect:this.handleSelect},a)};a.prototype.renderGSV2TypeaheadList=function(a,c){b("ReactDOM").render(b("React").createElement(b("FacebarTypeaheadGSV2List.react"),{results:this.results,listProps:a,keywordResults:this.keywordResults,entityResults:this.entityResults,seeMoreResult:this.seeMoreResult,entityTop:this.entityTop,isNewClassicSearch:this.isNewClassicSearch,isNullState:this.isNullState(),accessibilityElement:this.accessibilityElement,onClearHighlight:this.handleClearHighlight,onHighlight:this.handleHighlight,onRender:this.handleRender,onSelect:this.handleSelect}),c)};a.prototype.renderTypeaheadList=function(a){a=a||{},this.renderGSV2TypeaheadList(a,this.resultsContainer)};e.exports=a}),null);
__d("FacebarTypeaheadBrowsePreload",["AsyncRequest","XWarmUserRequestArgsController","emptyFunction"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(a){this._core=a.core,this._typeahead=a}a.prototype.enable=function(){this._core.subscribe("execute",this.preloadOnNavigate.bind(this))};a.prototype.preloadOnNavigate=function(a,c){if(c.type==="keyword"){a=b("XWarmUserRequestArgsController").getURIBuilder().setString("query",String(c.text));c.csid&&a.setString("csid",String(c.csid));new(b("AsyncRequest"))().setURI(a.getURI()).setAllowCrossPageTransition(!0).setOption("suppressErrorAlerts",!0).send()}};a.prototype.disable=function(){b("emptyFunction")()};e.exports=a}),null);
__d("FacebarTypeaheadInjectedSuggestion",["csx","cx","fbt","Arbiter","DOM"],(function(a,b,c,d,e,f,g,h,i){"use strict";__p&&__p();var j=3,k=0,l;function a(a){this.core=a.getCore(),this.$1=this.core.view}a.prototype.enable=function(){b("Arbiter").subscribe("FacebarTypeahead.injectedSuggestion",function(){return this.addSuggestionTextToSearchBox()}.bind(this)),b("Arbiter").subscribe("FacebarTypeahead.removeInjectedSuggestion",function(){return this.removeSuggestionTextToSearchBox()}.bind(this)),b("Arbiter").subscribe("FacebarTypeahead.showSuggestionBadge",function(){return this.showSuggestionBadge(!0)}.bind(this)),b("Arbiter").subscribe("FacebarTypeahead.hideSuggestionBadge",function(){return this.showSuggestionBadge(!1)}.bind(this))};a.prototype.disable=function(){this.$2.unsubscribe()};a.prototype.showSuggestionBadge=function(a){var c=b("DOM").scry(this.core.getElement(),"._5861")[0];if(c){c=c.getElementsByClassName("injectedSearchSuggestion")[0];if(!c)return;a?c.style.visibility="visible":c.style.visibility="hidden"}};a.prototype.removeSuggestionTextToSearchBox=function(){__p&&__p();if(!k)return;--k;if(!k){var a=b("DOM").scry(this.core.getElement(),"._5861")[0],c=a.getElementsByClassName("injectedSearchSuggestion")[0];a.removeChild(c)}else if(l){a=i._({"suggestion":"{suggestionCount} new suggestion","suggestions":"{suggestionCount} new suggestions"},[i._param("suggestionCount",k),i._enum(k===1?"suggestion":"suggestions",{suggestion:"suggestion",suggestions:"suggestions"})]);l.innerText=a}};a.prototype.addSuggestionTextToSearchBox=function(){__p&&__p();if(k)l&&k<j&&(l.innerText=k+1+" new suggestions");else{var a=b("DOM").scry(this.core.getElement(),"._5861")[0];if(a){l=document.createElement("DIV");var c=document.createTextNode("1 new suggestion");l.style.cssFloat="right";l.appendChild(c);c=document.createElement("DIV");c.className="_586j injectedSearchSuggestion";c.appendChild(l);a.appendChild(c)}}k+=1};e.exports=a}),null);
__d("FacebarTypeaheadNavigation",["Arbiter","FacebarNavigation","emptyFunction"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(a){this._core=a.core,this._preserveQuery=!1,this._typeahead=a}a.prototype.enable=function(){b("FacebarNavigation").registerBehavior(this),this._core.subscribe("execute",this.executedUserQuery.bind(this))};a.prototype.executedUserQuery=function(a,b){this._preserveQuery=!0};a.prototype.pageTransition=function(){!this._preserveQuery?(this._core.close(),this._core.reset()):this._preserveQuery=!1};a.prototype.setPageQuery=function(a){a=this._core.setPageQuery(a),this._typeahead.inform("navigation",a,"persistent")};Object.assign(a.prototype,{disable:b("emptyFunction")});e.exports=a}),null);
__d("FacebarTypeaheadPrefixLengthOrderedCache",["Arbiter","emptyFunction"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(a){this._typeahead=a}a.prototype.enable=function(){this._typeahead.data.inform("setSortFunction",function(a){return function(b,c){if((b.keyword_type==="local"||b.keyword_type==="local_category")&&(c.keyword_type==="local"||c.keyword_type==="local_category"))return 0;if(b.cache_id_length!==c.cache_id_length)return b.cache_id_length-c.cache_id_length;var d=this.getCost(b,a)-this.getCost(c,a);return d!==0?d:(b.semantic||"").localeCompare(c.semantic||"")}.bind(this)}.bind(this),"state")};a.prototype.getCost=function(a,b){return a.cost||0};Object.assign(a.prototype,{disable:b("emptyFunction")});e.exports=a}),null);
__d("FacebarTypeaheadQuickSelect",["FacebarStructuredText","URI"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g="/search/web/direct_search.php";function a(a){this._core=a.getCore(),this._view=a.getView(),this._input=this._core.input,this._beforeSelectListener=null,this._quickSelectListener=null}a.prototype.enable=function(){this._beforeSelectListener=this._view.subscribe("beforeSelect",this._quickSelect.bind(this)),this._quickSelectListener=this._view.subscribe("quickSelect",this._quickSelect.bind(this))};a.prototype._quickSelect=function(a,c){__p&&__p();if(c&&c.selected)return!0;a=this._input.getValue().toArray();c=new(b("FacebarStructuredText"))(a);a=c.toString();if(!a)return!0;c=new(b("URI"))(g).addQueryData("q",a);a={input_query:a,type:"quickselect",text:a,position:0,with_mouse:0,semantic:"quickselect("+c.toString()+")",extra_uri_params:{source:"quickselect",sid:this._core.getSessionID()},uri:c};this._core.inform("quickSelectRedirect",a);this._core.executeQuery(a);return!1};a.prototype.disable=function(){this._beforeSelectListener&&this._view.unsubscribe(this._beforeSelectListener),this._quickSelectListener&&this._view.unsubscribe(this._quickSelectListener)};e.exports=a}),null);
__d("FacebarTypeaheadRecorderBasic",["FacebarTypeaheadRecorder"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(a){this._typeahead=a}a.prototype.enable=function(){var a=this._typeahead;this._recorder=new(b("FacebarTypeaheadRecorder"))(a)};a.prototype.disable=function(){this._typeahead.unsubscribe(this._subscription),this._recorder=null,this._subscription=null};Object.assign(a.prototype,{_subscription:null});e.exports=a}),null);
__d("FacebarTypeaheadSeeMore",["cx","fbt","FacebarGlobalOptions","FacebarGSv2Echo","FacebarJSConstants","FacebarKeywordSearchUtils","FacebarStructuredText"],(function(a,b,c,d,e,f,g,h){"use strict";__p&&__p();function a(a){this.$1=a.getCore(),this.$2=this.$1.view}a.prototype.enable=function(){this.$3=this.$2.subscribe("seeMore",this.$4.bind(this))};a.prototype.disable=function(){this.$3.unsubscribe()};a.prototype.$4=function(a,c){a=c.value.toString().trim();a=b("FacebarGSv2Echo").normalizeValue(a);c=b("FacebarKeywordSearchUtils").makeFacebarEntry(a);var d;b("FacebarGlobalOptions").hasKeywordOnlyTypeahead?d=h._("See all results for {query}",[h._param("query",a)]):d=h._("See all results for \"{query}\"",[h._param("query",a)]);return babelHelpers["extends"]({},c,{query_string:a,icon_class:"_5b1w",isSeeMore:!0,structure:b("FacebarStructuredText").fromString(a),displayStructure:b("FacebarStructuredText").fromString(String(d)),uri:c.uri,tags:{},isSingleState:this.$1.data.getSingleState(),keywordType:b("FacebarJSConstants").keywordTypes.escape,keywordSource:b("FacebarJSConstants").keywordTypes.escape})};e.exports=a}),null);
__d("FacebarTypeaheadSelectAll",["requestAnimationFrame"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(a){this._core=a.getCore(),this._listener=null}a.prototype.enable=function(){var a=this._core.input;this._listener=this._core.subscribe("focus",function(c,d){c=d&&d.catchup;c||b("requestAnimationFrame")(function(){a.selectInput()})})};a.prototype.disable=function(){this._listener&&this._core.unsubscribe(this._listener)};e.exports=a}),null);
__d("FacebarTypeaheadShortcut",["fbt","CurrentUser","KeyboardShortcuts","URI","UserAgent","XFacebookWorkChatInboxController","gkx","translateKey"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();function a(a){this._input=a.core.input,this._view=a.view,this._listener=null}a.prototype.enable=function(){this._registerListener()};a.prototype.disable=function(){};a.prototype._registerListener=function(){this._listener&&this._listener.remove();var a=b("UserAgent").isPlatform("Mac OS X"),c=b("URI").getRequestURI().getPath().startsWith(b("XFacebookWorkChatInboxController").getURIBuilder().getURI().getPath()),d=a?b("translateKey")("cmd"):b("translateKey")("ctrl");this._listener=b("CurrentUser").isWorkUser()&&b("gkx")("792924")&&!c?b("KeyboardShortcuts").register("k",this._selectInput.bind(this),{baseFilters:[function(b){return!a&&b.ctrlKey||a&&b.metaKey}],persistOnTransition:!0,shortcutInfo:{displayKeys:[d,b("translateKey")("k")],description:g._("Search")}}):b("KeyboardShortcuts").register("SLASH",this._selectInput.bind(this),{filter:function(a,b){return!a.getModifiers().shift},persistOnTransition:!0,shortcutInfo:{displayKeys:[b("translateKey")("/")],description:g._("Search")}})};a.prototype._selectInput=function(){this._view.setAutoSelect(!0),this._input.focus(),this._input.selectInput(),this._input.inform("shortcut",{shift:!1})};e.exports=a}),null);
__d("FacebarTypeaheadStickyFilters",["Arbiter","NavigationMessage","Run","SubscriptionsHandler","enumerate","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=!1,h=5e3,i="/search/top";function a(a){this.core=a.getCore(),this.filters={},this.subscriptionsHandler=new(b("SubscriptionsHandler"))(),this.view=this.core.view}a.prototype.enable=function(){__p&&__p();this.subscriptionsHandler.addSubscriptions(b("Arbiter").subscribe("SearchLHCFilters.initStickyFilters",function(a,c){__p&&__p();for(var a=b("enumerate")(this.filters),d=Array.isArray(a),e=0,a=d?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(d){if(e>=a.length)break;f=a[e++]}else{e=a.next();if(e.done)break;f=e.value}f=f;var g=f[0];f=f[1];g in c||(f.active=!1)}for(var g=b("enumerate")(c),f=Array.isArray(g),e=0,g=f?g:g[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(f){if(e>=g.length)break;d=g[e++]}else{e=g.next();if(e.done)break;d=e.value}a=d;c=a[0];d=a[1];a={value:d,active:!0};this.filters[c]=a}}.bind(this)),b("Arbiter").subscribe(b("NavigationMessage").NAVIGATION_BEGIN,function(a,b){this.resetFiltersIfNotSearching()}.bind(this)),this.view.subscribe("filter",this.handleFilter.bind(this)),this.core.subscribe("magSearch",this.handleSearch.bind(this)),this.view.subscribe("afterSeeMore",this.handleSeeMore.bind(this))),b("Run").onLeave(function(){this.resetFiltersIfNotSearching()}.bind(this))};a.prototype.disable=function(){this.teardown()};a.prototype.teardown=function(){this.subscriptionsHandler.release()};a.prototype.handleFilter=function(a,b){a=b.results.filter(function(a){return!a.isNullState&&!a.isTrending});this.updateResultData(a)};a.prototype.handleSearch=function(a,b){this.updateResultData([b])};a.prototype.handleSeeMore=function(a,b){a=b.results.filter(function(a){return a.isSeeMore});this.updateResultData(a)};a.prototype.resetFiltersIfNotSearching=function(){__p&&__p();if(g)return;g=!0;b("setTimeoutAcrossTransitions")(function(){__p&&__p();var a=window.location.pathname;if(a.indexOf(i)===-1)for(var a=b("enumerate")(this.filters),c=Array.isArray(a),d=0,a=c?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e;if(c){if(d>=a.length)break;e=a[d++]}else{d=a.next();if(d.done)break;e=d.value}e=e;e=e[1];e.active=!1}g=!1;b("Run").onLeave(function(){this.resetFiltersIfNotSearching()}.bind(this))}.bind(this),h)};a.prototype.updateResultData=function(a){__p&&__p();for(var c=0;c<a.length;c++){var d=a[c];if(d.type==="keyword"){var e=d.uri.getQueryData();for(var f=b("enumerate")(this.filters),g=Array.isArray(f),h=0,f=g?f:f[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var i;if(g){if(h>=f.length)break;i=f[h++]}else{h=f.next();if(h.done)break;i=h.value}i=i;var j=i[0];i=i[1];i.active?e[j]=i.value:d.uri.removeQueryData(j)}}}};e.exports=a}),null);
__d("TypeaheadEarlyUserRequest",["AsyncRequest","XWarmUserRequestArgsController"],(function(a,b,c,d,e,f){"use strict";function a(a){this._core=a.getCore(),this._listener=null}a.prototype.enable=function(){this._listener=this._core.subscribe("focus",function(a,c){new(b("AsyncRequest"))().setURI(b("XWarmUserRequestArgsController").getURIBuilder().getURI()).send(),this.disable()}.bind(this))};a.prototype.disable=function(){this._listener&&this._core.unsubscribe(this._listener)};e.exports=a}),null);